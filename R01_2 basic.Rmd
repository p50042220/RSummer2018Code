---
title: "Basic operations"
author: "Jilung Hsieh"
date: "2018/7/3"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




## 載入資料

* 直接從網路上載入台北市竊盜案資料
* `df <- read.csv(url, fileEncoding = "big5")`這行的意思是把上面那個`url`用`read.csv()`這個函式讀取。讀取的同時，由於一般EXCEL為中文編碼`BIG5`，所以該文件八成是該台北市政單位還用EXCEL在編資料，所以要跟程式碼講說，這個網址所指到的檔案編碼為`BIG5`。
* `fileEncoding = "big5"`稱為`read.csv()`這個函式的**參數(parameter)。
* `df`為一個自定義的變數，你愛定成什麼就定成什麼名字，唯獨不能是數字或特殊符號開頭，最好都是用英文開頭。為何命名為`df`是因為他是一個`data.frame`，思考上，他很像一個EXCEL表格。每個欄位(Column)為一個變數，每列(Row)為一筆資料。
* `<-`的記號稱為Assignment，在程式中，總是將右方的執行結果Assign給左方的變數。當我們在數學式`x = 100 + 4`時，我們做的事情也是將`100 + 4`後的結果Assign給左方的`x`。
```{r}
url <- "http://data.taipei/opendata/datalist/datasetMeta/download?id=68785231-d6c5-47a1-b001-77eec70bec02&rid=34a4a431-f04d-474a-8e72-8d3f586db3df"
df <- read.csv(url, fileEncoding = "big5")
```




### DF1: 觀察資料內容

* `View(df)` 用RStudio所提供的GUI直接觀看變數
* `head(df)` 取前面六筆資料（也就是六列的資料來概觀該資料）
* `class(df)` 印出該
* `str(df)`


```{r}
# View(df)
head(df)	# get first part of the data.frame
class(df)
str(df)

summary(df)
# look up help
help(summary)
?summary

```



### DF2: 觀察資料維度

```{r}
dim(df)
ncol(df)
nrow(df)
length(df)
```


### DF3: 抽取資料中的變數
* `names(df)`  列出變數名稱
* `df$發生.現.地點` 顯示該變數內容
* `df$發生時段` 顯示該變數內容
* `length(df$發生時段)` 顯示該變數的長度（相當於有幾個）

```{r}
names(df)
df$發生.現.地點
df$發生時段
length(df$發生時段)
```


## Vector
* [台灣出口進口貿易資料查詢](http://cus93.trade.gov.tw/FSC3040F/FSC3040F?menuURL=FSC3040F)

### V1: Creation

```{r}
country <- c("CN", "US", "JP", "HK", "KR", "SG", "DE", "MY", "VN", "PH", "TH", "AU", "NL", "SA", "ID", "GB", "IN", "FR", "IT", "AE")
p.import <- c(26.142, 12.008, 7.032, 13.646, 4.589, 5.768, 2.131, 2.802, 3.428, 3.019, 1.976, 1.118, 1.624, 0.449, 0.983, 1.302, 1.027, 0.553, 0.670, 0.455)
p.export <- c(22.987, 12.204, 11.837, 7.739, 5.381, 4.610, 2.866, 2.784, 2.414, 2.092, 1.839, 1.788, 1.665, 1.409, 1.391, 1.075, 0.974, 0.899, 0.800, 0.728)
```


```{r}
a <- seq(11, 99, 11)
b <- 11:20
# create by distribution
x <- runif(1000, 1, 10) # uniform dist, n=1000
x <- rnorm(10000000, 1, 10) # normal dist, n=1000
```


### V2: Viewing
```{r}
country
p.import
head(country)
tail(country)
length(country)
# View(country)
```


### V3: Subsetting, filtering
```{r}
country[c(1, 3, 5)]
country[c(5, 3, 1)]
country[3:7]

a <- seq(11, 99, 11)
a[3:length(a)]
a[length(a):3]
```

### V4: Plotting
```{r}
plot(density(x))
```


### V5: Deleting
* Without assignment, deletion won't change original vectors
```{r}
b <- 11:20
b[-(3:5)]
b[-c(1, 3, 5)]
b
```

* Correct deletion with assignment to replace original vector
```{r}
b <- b[-(3:5)]
b

a <- seq(11, 99, 11)
a <- a[-c(1, 3, 5)]
a

```


### V6: Concatinating
```{r}
a <- 1:10
a <- c(a, 11)
a
b
a <- c(a, b)
a
a <- c(a, a, b)
a
```



### V7: Arithmetic operations

```{r}
a <- 11:19
a + 3
a / 2

a %% 2
a %/% 2
a %% 2== 0
a %% 2 != 0
a[a%% 2 == 0]
a[a%%2 != 0]
a <- a %% 2 	# modular arithmetic, get the reminder
a <- a %/% 2 	# Quotient

```




### V8: Logic comparisons
```{r}
a %% 2 == 0 	# deteting odd/even number
a %% 2 != 0
a[a%%2==0]
a > b
p.import > mean(p.import)
p.import > p.export

TRUE == T 		# == equal to,
TRUE != F    	# != Not equal to

any(a>11) # is there any element larger than 1
all(a>11) # are all elements larger than 1

```


### V9: Subsetting by logic comparisons
* two methods to filter data from vectors, by index vector or a logical vector with equal length.

```{r}
a <- seq(11, 55, 11)
a[c(T, F, T, F, T)]
a[a%%2==1]
a%%2
a%%2==1
a <- c("你好","你好棒棒","你好棒","你真的好棒")
a[nchar(a)>3]

# which will return "index-of"
a <- seq(11, 55, 11)
a[which(a%%2==1)]
which(a%%2==1)
```


### V10: Sorting

```{r}
x <- c(33, 55, 22, 13, 4, 24)

# Sort it directly
sort(x)


# Get the order
order(x) # 5, 4, 3, 6, 1, 2 <- the min to max sequence of original index
x[order(x)] # will produce identical vector with sort(x)

# assign to replace x
x <- sort(x)

```


### V11: Using built-in math functions
```{r}
a <- 11:19
min(a); max(a); mean(a); median(a); sd(a)
log2(a)
log1p(a)
?log1p
```


### V12: Checking data type
```{r}
mode(country)				# character
mode(p.import)					# numeric
mode(p.import > mean(p.import))	# logical

p.importc <- c("26.142", "12.008", "7.032", "13.646", "4.589")
mode(p.importc)				# character

```


### V13: Converting data type
```{r}
# character > numeric > logical

p.importc <- as.character(p.import)
p.importn <- as.numeric(p.importc)

a <- seq(11, 99, 11)
a <- c(a, "100")

a <- seq(11, 99, 11)
sum(a%%2==1)

```



### V14: Character operations
```{r}
a <- seq(11, 55, 11)
paste("A", a)		# concatenate
paste0("A", a)		# concatenate

```





## Practice
```{r}
x.a <- rnorm(1000, 1, 10)

# 1.1 Filter out extreme values out of two standard deviations


# 1.2 Plotting the distribution of the remaining vector x.a


# 1.3 Calculate the 25% 50% and 75% quantile of vector x.a. You may google "quantile r"


# 1.4 Get the number between 25% to 75%



x.b <- c("a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k")

# 2.1 Get only elements at odd positions

# 2.2 Truncate the first 2 elements and the last 2 elements

```



## DF(continue)

### DF4: 合併vector為data.frame

```{r}
df <- data.frame(country, p.import, p.export)
df <- data.frame(country, p.import, p.export, stringsAsFactors = FALSE)
str(df)
```



### DF5: 透過運算產生新變數

```{r}
df$sub <- df$p.import - df$p.export
```


### DF6: 篩選資料、選取變數
```{r}
df
names(df)

# filter row data by column value
df[df$p.import > df$p.export,]
df[df$p.import > df$p.export,]$country
df[df$p.import > df$p.export,1]

# 1 row == a data.frame with only one data entry
class(df[df$p.import > df$p.export,1])
class(df[,1]) # character vector
class(df[1,]) # data.frame
class(unlist(df[1, -1])) # filter the 1st row and select all columns except 1

```



### DF7: 按照某個變數排序
```{r}
# sort rows by df$p.import column
df.sorted <- df[order(df$p.import),]
# View(df.sorted)

# sort rows in decreasing order
df.sorted <- df[order(df$p.import, decreasing = T),]

# add - to column in order() can sort in decreasing order
df.sorted <- df[order(-df$p.import),]
# View(df.sorted)

a <- c(5, 5, 5, 5, 4, 4, 4, 3, 3, 1, 1, 1, 2, 2, 2)
b <- c(3, 3, 3, 4, 4, 4, 2, 2, 2, 4, 4, 1, 4, 1, 1)
df2 <- data.frame(a, b)

# sort df2 in orders of decreasing b then increasing a
df2 <- df2[order(df2$a, -df2$b),]

```


### DF8: 繪圖
```{r}
# plot(df) # raise error, 1st column is a character vector
plot(df[, 2:3])
plot(df[1:10, 2:3])
text(p.import, p.export, labels=country, cex= 0.5, pos=3)
lines(1:25, 1:25, col='red')

dev.new()

```



