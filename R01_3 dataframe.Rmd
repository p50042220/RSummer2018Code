---
title: "Basic: data.frame"
author: "Jilung Hsieh"
date: "2018/7/3"
output: 
  html_document: 
    number_sections: true
    highlight: zenburn
    theme: united
    toc: yes
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




# 載入資料

* 直接從網路上載入台北市竊盜案資料
* `df <- read.csv(url, fileEncoding = "big5")`這行的意思是把上面那個`url`用`read.csv()`這個函式讀取。讀取的同時，由於一般EXCEL為中文編碼`BIG5`，所以該文件八成是該台北市政單位還用EXCEL在編資料，所以要跟程式碼講說，這個網址所指到的檔案編碼為`BIG5`。
    * `fileEncoding = "big5"`稱為`read.csv()`這個函式的**參數(parameter)。
* `df`為一個自定義的變數，你愛定成什麼就定成什麼名字，唯獨不能是數字或特殊符號開頭，最好都是用英文開頭。為何命名為`df`是因為他是一個`data.frame`，思考上，他很像一個EXCEL表格。每個欄位(Column)為一個變數，每列(Row)為一筆資料。
* `<-`的記號稱為Assignment，在程式中，總是將右方的執行結果Assign給左方的變數。當我們在數學式`x = 100 + 4`時，我們做的事情也是將`100 + 4`後的結果Assign給左方的`x`。

* `stringsAsFactors = FALSE`也是`read.csv()`的


```{r}
url <- "http://data.taipei/opendata/datalist/datasetMeta/download?id=68785231-d6c5-47a1-b001-77eec70bec02&rid=34a4a431-f04d-474a-8e72-8d3f586db3df"
df <- read.csv(url, fileEncoding = "big5")
str(df)

```

* 這時候我們若以`str(df)`觀察該`df`的結構會發現，文字型態的資料被轉為`Factors`，這是我們所不樂見的。過去統計通常會把文字型態當成類別變數，於是用`Factors`作為資料型態，但資料科學中經常要處理大量的文字資料，此時，我們可以把`read.csv`的一個參數`stringsAsFactors`設為`FALSE`，意味著預設不要將文字的資料轉為Factor而是直接以文字變項來處理。
```{r}
df <- read.csv(url, fileEncoding = "big5", stringsAsFactors = FALSE)
str(df)
```



* **Tips**部分Mac電腦無法使用`read.csv()`從網路上取得資料又轉為`data.frame`，一個可行的辦法是先用`GET(url, write_disk("test.csv"))`將其取回並命名為`test.csv`，之後再用`df <- read.csv("test.csv", fileEncoding = "big5", stringsAsFactors = FALSE)`直接讀取該檔案。

```{r}
library(httr)
GET(url, write_disk("test.csv", overwrite = TRUE))
df <- read.csv("test.csv", fileEncoding = "big5", stringsAsFactors = FALSE)
```


# DF1: 觀察資料內容

* `View(df)` 用RStudio所提供的GUI直接觀看變數
* `head(df)` 取前面六筆資料（也就是六列的資料來概觀該資料）
* `class(df)` 印出該
* `str(df)`


```{r}
# View(df)
head(df)	# get first part of the data.frame
class(df)
str(df)

summary(df)
# look up help
help(summary)
?summary

```



# DF2: 觀察資料維度

```{r}
dim(df)
ncol(df)
nrow(df)
length(df)
```


# DF3: 抽取資料中的變數
* `names(df)`  列出變數名稱
* `df$發生.現.地點` 顯示該變數內容
* `df$發生時段` 顯示該變數內容
* `length(df$發生時段)` 顯示該變數的長度（相當於有幾個）

```{r}
names(df)
head(df$發生.現.地點)
head(df$發生時段)
length(df$發生時段)
```


# 進出口貿易資料範例
* [台灣出口進口貿易資料查詢](http://cus93.trade.gov.tw/FSC3040F/FSC3040F?menuURL=FSC3040F)

```{r}
country <- c("CN", "US", "JP", "HK", "KR", "SG", "DE", "MY", "VN", "PH", "TH", "AU", "NL", "SA", "ID", "GB", "IN", "FR", "IT", "AE")
p.import <- c(26.142, 12.008, 7.032, 13.646, 4.589, 5.768, 2.131, 2.802, 3.428, 3.019, 1.976, 1.118, 1.624, 0.449, 0.983, 1.302, 1.027, 0.553, 0.670, 0.455)
p.export <- c(22.987, 12.204, 11.837, 7.739, 5.381, 4.610, 2.866, 2.784, 2.414, 2.092, 1.839, 1.788, 1.665, 1.409, 1.391, 1.075, 0.974, 0.899, 0.800, 0.728)
```





# DF4: 合併vector為data.frame

```{r}
df <- data.frame(country, p.import, p.export)
df <- data.frame(country, p.import, p.export, stringsAsFactors = FALSE)
str(df)
```



# DF5: 透過運算產生新變數

```{r}
df$sub <- df$p.import - df$p.export
```


# DF6: 篩選資料、選取變數
```{r}
df
names(df)

# filter row data by column value
df[df$p.import > df$p.export,]
df[df$p.import > df$p.export,]$country
df[df$p.import > df$p.export,1]

# 1 row == a data.frame with only one data entry
class(df[df$p.import > df$p.export,1])
class(df[,1]) # character vector
class(df[1,]) # data.frame
class(unlist(df[1, -1])) # filter the 1st row and select all columns except 1

```



# DF7: 按照某個變數排序
```{r}
# sort rows by df$p.import column
df.sorted <- df[order(df$p.import),]
# View(df.sorted)

# sort rows in decreasing order
df.sorted <- df[order(df$p.import, decreasing = T),]

# add - to column in order() can sort in decreasing order
df.sorted <- df[order(-df$p.import),]
# View(df.sorted)

a <- c(5, 5, 5, 5, 4, 4, 4, 3, 3, 1, 1, 1, 2, 2, 2)
b <- c(3, 3, 3, 4, 4, 4, 2, 2, 2, 4, 4, 1, 4, 1, 1)
df2 <- data.frame(a, b)

# sort df2 in orders of decreasing b then increasing a
df2 <- df2[order(df2$a, -df2$b),]

```


# DF8: 繪圖
```{r}
# plot(df) # raise error, 1st column is a character vector
plot(df[, 2:3])
plot(df[1:10, 2:3])
text(p.import, p.export, labels=country, cex= 0.5, pos=3)
lines(1:25, 1:25, col='red')

dev.new()

```



